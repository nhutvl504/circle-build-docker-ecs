machine:
  services:
    - docker
general:
  artifacts:
    - "app"
dependencies:
  post:
    - docker build -t $DEV_AWS_ECR_URI:$CIRCLE_SHA1 .
test:
  pre:
    - aws configure list
  - post:
    - docker run -d -p 8080:8080 --name sample-go-webapp $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/testcirclecidocker:$CIRCLE_SHA1; sleep 10
  override:
    - echo "done "
deployment:
  prod:
    branch: master
    commands:
      - bash ./ecs-deploy -k $AWS_ACCESS_KEY_ID -s $AWS_SECRET_ACCESS_KEY -r $AWS_DEFAULT_REGION -c TestCI -d "TaskCreate" -i '$AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/testcirclecidocker:CIRCLE_SHA1'
