machine:
  services:
    - docker
general:
  artifacts:
    - "app"
dependencies:
  post:
    - docker build -t $DEV_AWS_ECR_URI:$CIRCLE_SHA1 .
test:
  pre:
    - aws configure list
  override:
    - echo "done "
deployment:
  prod:
    branch: master
    commands:
      - aws ecr get-login --no-include-email --region ap-northeast-1
      - docker push 647433451523.dkr.ecr.ap-northeast-1.amazonaws.com/testcirclecidocker
      - bash ./ecs-deploy -k $AWS_ACCESS_KEY_ID -s $AWS_SECRET_ACCESS_KEY -r $AWS_DEFAULT_REGION -c TestCI -d "TaskCreate" -i '$AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/testcirclecidocker:CIRCLE_SHA1'
